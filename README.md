# 谁是卧底 - 主持方平台

这是一个"谁是卧底"游戏的主持方平台，用于管理游戏流程、展示游戏状态和处理游戏逻辑。

## 功能特性

- 游戏方注册和组名管理
- 随机分配卧底和平民身份
- 接收和展示游戏方的描述
- 处理投票并判定结果
- 自动计算得分
- 异常上报与记录
- 实时可视化界面

## 响应格式

所有后端 API 均返回统一结构：

```json
{
  "code": 200,
  "message": "ok",
  "data": {
    "...": "..."
  }
}
```

当 `code != 200` 时，请根据 `message` 判断失败原因，`data` 会附带可选的调试信息。

## 安装和运行

1. （主持方才需要！！）设置主持方令牌 `ADMIN_TOKEN`（后端和前端需要一致）：
   - Windows PowerShell：
     ```powershell
     $env:ADMIN_TOKEN="host-secret"
     ```

   - 未设置时默认值为 `host-secret`，建议线上环境务必自定义。

2. 安装依赖：
```bash
pip install -r requirements.txt
```

3. 运行后端服务器：
```bash
python backend.py
```

4. 新开一个终端运行前端界面：
```bash
python frontend.py
```

5. 访问界面：
   - 前端界面：`http://localhost:5001`
   - 后端API：`http://localhost:5000`
   - 确保游戏方能够访问服务器的IP地址（局域网内）

6. 测试：
test_client.py要把`BASE_URL`改成主持方的ip地址。自己测试的时候就是填入后端日志里的局域网访问后面的地址。
```bash
python test_client.py
```

## 测试流程

1. 同时运行前后端
2. 在打开多个终端分别运行test_client.py，输入组名
3. 主持方在前端开始游戏并开始新回合
4. 游戏方按顺序发送描述
5. 游戏方进行投票
6. 主持方点击处理投票结果，如果卧底被票出去了则游戏结束（如果卧底存活，主持人要继续开始新回合，但是test到这里暂时结束了，对于游戏方游戏还是继续的）
   
注意：测试通过按enter手动控制流程进度，实际上线时应该是游戏方通过获取阶段状态来判断进行到哪一步了

## 游戏流程

1. 游戏方通过API注册，输入组名
2. 主持方随机选择卧底，分配词语
3. 游戏方按顺序发送描述
4. 游戏方进行投票
5. 主持方判定结果并计算得分


## 项目结构

```
Undercover/
├── backend.py          # 后端服务器（Flask API）
├── frontend.py         # 前端界面（Flask Web界面）
├── game_logic.py       # 游戏逻辑核心模块
├── requirements.txt    # 依赖包
├── README.md          # 项目说明
```

## 分工说明

本项目适合3人小组分工：

1. **网络通信负责人**: 负责API接口设计和文档编写
2. **前端开发负责人**: 负责可视化界面开发
3. **后端开发负责人**: 负责服务器和游戏逻辑开发

## 快速开始

### 1. 启动后端服务器

```bash
python backend.py
```

后端服务器会在 `http://0.0.0.0:5000` 启动，显示本机IP地址供游戏方连接。

### 2. 启动前端界面（可选）

```bash
python frontend.py
```

前端界面会在 `http://0.0.0.0:5001` 启动，提供可视化的游戏管理界面。

### 3. 游戏方连接

游戏方需要知道后端服务器的IP地址，然后通过API接口进行注册和游戏。
